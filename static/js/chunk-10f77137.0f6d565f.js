(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-10f77137"],{1613:function(t,e,o){"use strict";o.d(e,"a",(function(){return m})),o.d(e,"b",(function(){return g}));var a=o("2b0e");const s=a["default"].prototype.$isServer,i=(s||Number(document.documentMode),function(){return!s&&document.addEventListener?function(t,e,o){t&&e&&o&&t.addEventListener(e,o,!1)}:function(t,e,o){t&&e&&o&&t.attachEvent("on"+e,o)}}());(function(){!s&&document.removeEventListener})();const r=[],n="@@clickoutsideContext";let c,d=0;function l(t,e,o){return function(a={},s={}){!(o&&o.context&&a.target&&s.target)||t.contains(a.target)||t.contains(s.target)||t===a.target||o.context.popperElm&&(o.context.popperElm.contains(a.target)||o.context.popperElm.contains(s.target))||(e.expression&&t[n].methodName&&o.context[t[n].methodName]?o.context[t[n].methodName]():t[n].bindingFn&&t[n].bindingFn())}}!a["default"].prototype.$isServer&&i(document,"mousedown",t=>c=t),!a["default"].prototype.$isServer&&i(document,"mouseup",t=>{r.forEach(e=>e[n].documentHandler(t,c))});var m={bind(t,e,o){r.push(t);const a=d++;t[n]={id:a,documentHandler:l(t,e,o),methodName:e.expression,bindingFn:e.value}},update(t,e,o){t[n].documentHandler=l(t,e,o),t[n].methodName=e.expression,t[n].bindingFn=e.value},unbind(t){let e=r.length;for(let o=0;o<e;o++)if(r[o][n].id===t[n].id){r.splice(o,1);break}delete t[n]}},g={bind:function(t,e){t.onmousedown=function(t){var o=document.querySelector(String(e.arg));if(o){var a=t.clientX-o.offsetLeft,s=t.clientY-o.offsetTop,i=0,r=window.innerWidth-o.clientWidth,n=0,c=window.innerHeight-o.clientHeight;document.addEventListener("mousemove",d),document.addEventListener("mouseup",(function(){document.removeEventListener("mousemove",d),document.onmouseup=null}))}function d(t){var e=Math.min(Math.max(t.clientX-a,i),r),d=Math.min(Math.max(t.clientY-s,n),c);o.style.left=e+"px",o.style.top=d+"px"}}}}},"452c":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"main-container"},[e("el-row",{staticStyle:{background:"#2f2f2f","min-height":"40px"}},[e("el-col",{attrs:{span:8}},[e("el-button",{staticClass:"backbutton",staticStyle:{"margin-left":"20px","margin-top":"3px"},on:{click:t.back}},[e("i",{staticClass:"el-icon-back",staticStyle:{"font-size":"x-large"}})])],1),e("el-col",{staticStyle:{"text-align":"center","margin-top":"12px"},attrs:{span:8}},[e("div",{staticStyle:{"font-size":"16px",color:"#ececec"},attrs:{contenteditable:"true"}},[t._v(" "+t._s(t.title)+" ")]),e("div")])],1),e("el-dialog",{attrs:{title:"创建团队文件",visible:t.dialogCreateDoc},on:{"update:visible":function(e){t.dialogCreateDoc=e}}},[e("el-form",{attrs:{model:t.form_createDoc}},[e("el-form-item",{attrs:{label:"文档名称","label-width":t.formLabelWidth}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form_createDoc.doc_name,callback:function(e){t.$set(t.form_createDoc,"doc_name",e)},expression:"form_createDoc.doc_name"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogCreateDoc=!1,t.form_createDoc.doc_name=""}}},[t._v("取 消")]),e("el-button",{on:{click:function(e){t.CreateDoc(),t.dialogCreateDoc=!1}}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{title:"创建文档目录",visible:t.dialogCreateDir},on:{"update:visible":function(e){t.dialogCreateDir=e}}},[e("el-form",{attrs:{model:t.form_createDir}},[e("el-form-item",{attrs:{label:"目录名称","label-width":t.formLabelWidth}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form_createDir.dict_name,callback:function(e){t.$set(t.form_createDir,"dict_name",e)},expression:"form_createDir.dict_name"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogCreateDir=!1,t.form_createDir.dict_name=""}}},[t._v("取 消")]),e("el-button",{on:{click:function(e){t.CreateDir(),t.dialogCreateDir=!1}}},[t._v("确 定")])],1)],1),e("el-card",{staticClass:"margin-top-xs",staticStyle:{"max-width":"1050px",margin:"auto"},attrs:{"body-style":{padding:"0"}},scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{staticClass:"flex"},[e("div",{staticClass:"flex-sub"}),e("el-button",{staticStyle:{"margin-inline":"10px",background:"#49aaef",color:"white",border:"0"},on:{click:t.Save}},[e("i",{staticClass:"el-icon-plus"}),t._v(" 保存")]),t.is_favorite?t._e():e("el-button",{staticStyle:{"margin-inline":"10px",background:"orange",color:"white",border:"0"},on:{click:t.likeDoc}},[e("i",{staticClass:"el-icon-star-off"}),t._v(" 收藏")]),t.is_favorite?e("el-button",{staticStyle:{"margin-inline":"10px",background:"orange",color:"white",border:"0"},on:{click:t.unlikeDoc}},[e("i",{staticClass:"el-icon-star-on"}),t._v(" 取消收藏")]):t._e(),e("el-button",{staticStyle:{"margin-inline":"10px",background:"#16dcea",color:"white",border:"0"},on:{click:t.exportmd}},[e("i",{staticClass:"el-icon-upload"}),t._v(" 导出md")]),e("el-button",{staticStyle:{"margin-inline":"10px",background:"#16dcea",color:"white",border:"0"},on:{click:t.exportDocx}},[e("i",{staticClass:"el-icon-upload"}),t._v(" 导出docx")]),e("el-button",{staticStyle:{"margin-inline":"10px",background:"#16dcea",color:"white",border:"0"},on:{click:t.exportPng}},[e("i",{staticClass:"el-icon-upload"}),t._v(" 导出png")]),e("el-button",{staticStyle:{"margin-inline":"10px",background:"#16dcea",color:"white",border:"0"},on:{click:t.exportPDF}},[e("i",{staticClass:"el-icon-upload"}),t._v(" 导出pdf")]),e("el-button",{staticStyle:{"margin-inline":"10px",background:"#2ce8b9",color:"white",border:"0"},on:{click:t.openPreview}},[e("i",{staticClass:"el-icon-share"}),t._v(" 生成预览")]),e("el-button",{staticStyle:{"margin-inline":"10px",background:"#2ce8b9",color:"white",border:"0"},on:{click:t.closePreview}},[e("i",{staticClass:"el-icon-s-release"}),t._v(" 关闭预览")])],1)]},proxy:!0}])},[e("RichTextEditor",{ref:"richTextEditor",attrs:{id:"pdfDom",height:1e3},model:{value:t.editor,callback:function(e){t.editor=e},expression:"editor"}})],1),e("div",{directives:[{name:"drag",rawName:"v-drag:#drag",arg:"#drag"}],staticClass:"drag-box",attrs:{id:"drag"}},[t._m(0),e("el-table",{ref:"table",attrs:{data:t.data,"default-expand-all":!0,lazy:"","row-key":"dir_id","expand-row-keys":t.expands,"tree-props":{children:"children",hasChildren:"hasChildren"}},on:{"row-dblclick":t.toDocEditor}},[e("el-table-column",{attrs:{align:"left",label:"团队文档"},scopedSlots:t._u([{key:"default",fn:function(o){return["documentation"===o.row.type?e("i",{staticClass:"el-icon-document"}):t._e(),"documentation"!==o.row.type?e("i",{staticClass:"el-icon-folder"}):t._e(),e("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(o.row.dir_name))]),"dir"===o.row.type&&o.row.dir_id!==t.prj_root_id&&o.row.dir_parent_id!==t.prj_root_id?e("i",{staticClass:"el-icon-document-add",staticStyle:{"margin-left":"10px"},on:{click:function(e){t.form_createDoc.dest_folder_id=o.row.dir_id,t.dialogCreateDoc=!0}}}):t._e(),"dir"===o.row.type&&o.row.dir_id!==t.prj_root_id&&o.row.dir_parent_id!==t.prj_root_id?e("i",{staticClass:"el-icon-folder-add",staticStyle:{"margin-left":"5px"},on:{click:function(e){t.form_createDir.dest_folder_id=o.row.dir_id,t.dialogCreateDir=!0}}}):t._e()]}}])})],1)],1)],1)},s=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"boxhead"},[e("i",{staticClass:"el-icon-menu"}),e("p",[t._v("团队文档")])])}],i=(o("a9e3"),o("fb6a"),o("74ca")),r=o("0f9a"),n=o("4328"),c=o.n(n),d=o("8159"),l=o("1613"),m={name:"RichText",components:{RichTextEditor:i["default"]},directives:{drag:l["b"]},data:function(){return{url_preview:null,is_favorite:"true"===localStorage.getItem("is_favorite"),form_likeDoc:{token:r["getters"].getToken(r["state"]),doc_id:null,undo:null},imgUrl:"",dialogCreateDoc:!1,dialogCreateDir:!1,prj_root_id:localStorage.getItem("prj_root_id"),dialogVisible_share:!1,form_html2:{token:r["getters"].getToken(r["state"]),url:null},form_openPreview:{token:r["getters"].getToken(r["state"]),doc_id:localStorage.getItem("doc_id"),html_code:null},form_closePreview:{token:r["getters"].getToken(r["state"]),doc_id:localStorage.getItem("doc_id")},form_createDoc:{token:r["getters"].getToken(r["state"]),doc_name:"",team_id:localStorage.getItem("team_id"),dest_folder_id:""},form_createDir:{token:r["getters"].getToken(r["state"]),dict_name:"",dest_folder_id:""},form:{token:r["getters"].getToken(r["state"]),user_id:r["getters"].getUserId(r["state"]),username:r["getters"].getUserName(r["state"]),word_id:localStorage.getItem("word_id"),word_content:""},form1:{token:r["getters"].getToken(r["state"]),user_id:r["getters"].getUserId(r["state"]),username:r["getters"].getUserName(r["state"]),word_id:localStorage.getItem("word_id"),word_name:""},form_save:{token:r["getters"].getToken(r["state"]),doc_id:localStorage.getItem("doc_id"),doc_content:""},form_Model:{token:r["getters"].getToken(r["state"]),name:"模板",content:""},form3:{token:r["getters"].getToken(r["state"]),user_id:r["getters"].getUserId(r["state"]),username:r["getters"].getUserName(r["state"]),word_id:localStorage.getItem("word_id")},form4:{word_id:Number(localStorage.getItem("word_id")),word_name:localStorage.getItem("word_name")},form_invite:{token:r["getters"].getToken(r["state"]),user_id:r["getters"].getUserId(r["state"]),username:r["getters"].getUserName(r["state"]),accept_id:null,word_id:localStorage.getItem("word_id")},form_getCooperatorList:{token:r["getters"].getToken(r["state"]),user_id:r["getters"].getUserId(r["state"]),username:r["getters"].getUserName(r["state"]),word_id:localStorage.getItem("word_id")},form_getCommentList:{token:r["getters"].getToken(r["state"]),user_id:r["getters"].getUserId(r["state"]),username:r["getters"].getUserName(r["state"]),word_id:localStorage.getItem("word_id")},form_addComment:{token:r["getters"].getToken(r["state"]),user_id:r["getters"].getUserId(r["state"]),username:r["getters"].getUserName(r["state"]),word_id:localStorage.getItem("word_id"),comment_content:""},form_deleteCooperator:{token:r["getters"].getToken(r["state"]),user_id:r["getters"].getUserId(r["state"]),username:r["getters"].getUserName(r["state"]),word_id:localStorage.getItem("word_id"),cooperation_id:0},form_getTeam:{token:r["getters"].getToken(r["state"]),user_id:r["getters"].getUserId(r["state"]),teamId:Number(localStorage.getItem("team_id"))},isShow:!0,invite_visible:!1,comment_visible:!1,title:localStorage.getItem("doc_name"),htmlContent:"",jsonContent:"",comment:"",ID:"",cooperatorList:[],commentList:[],loading:!1,data:[]}},created:function(){this.getModel(),this.getDocTree(),d["a"].changeDevice("mobile"),d["a"].toggleCollapse(!0),"true"===localStorage.getItem("shareFlag")&&"false"===localStorage.getItem("addCooper")&&(this.isShow=!1)},mounted:function(){d["a"].changeDevice("mobile"),d["a"].toggleCollapse(!0)},beforeDestroy:function(){this.exitEdit()},destroyed:function(){d["a"].changeDevice("pc"),d["a"].toggleCollapse(!1)},methods:{exportmd:function(){var t=this;this.getHtmlContent(),this.form_openPreview.html_code=this.htmlContent,this.$axios.post("/doc/uploadDoc",c.a.stringify(this.form_openPreview)).then((function(e){e.data.success&&(t.form_html2.url=e.data.data[0].url,t.$axios.post("/doc/htmlToMarkdown",c.a.stringify(t.form_html2)).then((function(e){e.data.success&&(t.$message.success(e.data.message),window.open(e.data.data[0].url,"_blank"))})))}))},exportDocx:function(){var t=this;this.getHtmlContent(),this.form_openPreview.html_code=this.htmlContent,this.$axios.post("/doc/uploadDoc",c.a.stringify(this.form_openPreview)).then((function(e){e.data.success&&(t.form_html2.url=e.data.data[0].url,t.$axios.post("/doc/htmlToDocx",c.a.stringify(t.form_html2)).then((function(e){e.data.success&&(t.$message.success(e.data.message),window.open(e.data.data[0].url,"_blank"))})))}))},exportPng:function(){var t=this;this.getHtmlContent(),this.form_openPreview.html_code=this.htmlContent,this.$axios.post("/doc/uploadDoc",c.a.stringify(this.form_openPreview)).then((function(e){e.data.success&&(t.form_html2.url=e.data.data[0].url,t.$axios.post("/doc/htmlToPNG",c.a.stringify(t.form_html2)).then((function(e){e.data.success&&(t.$message.success(e.data.message),window.open(e.data.data[0].url,"_blank"))})))}))},openPreview:function(){var t=this;this.getHtmlContent(),this.form_openPreview.html_code=this.htmlContent,this.$axios.post("/doc/uploadDoc",c.a.stringify(this.form_openPreview)).then((function(e){e.data.success?(t.url_preview=e.data.data[0].url,alert("您的分享链接是"+t.url_preview),localStorage.setItem("refresh","1")):t.$message.error(e.data.message)}))},closePreview:function(){var t=this;this.$axios.post("/doc/disableSharing",c.a.stringify(this.form_closePreview)).then((function(e){e.data.success?t.$message.success(e.data.message):t.$message.error(e.data.message)}))},getModel:function(){this.$axios.get("/doc/getTemplateList",{params:{token:r["getters"].getToken(r["state"])}}).then((function(t){t.data.success&&console.log(t.data.data)}))},CreateDir:function(){var t=this;this.$axios.post("/doc/mkdir",c.a.stringify(this.form_createDir)).then((function(e){e.data.success?t.$message.success(e.data.message):t.$message.error(e.data.message),t.getDocTree()}))},CreateDoc:function(){var t=this;this.$axios.post("/doc/newDoc",c.a.stringify(this.form_createDoc)).then((function(e){e.data.success?t.$message.success(e.data.message):t.$message.error(e.data.message),t.getDocTree()}))},toDocEditor:function(t){var e=this;"documentation"===t.type&&(localStorage.setItem("flag","in"),localStorage.setItem("doc_id",t.doc_id),localStorage.setItem("doc_name",t.doc_name),this.$axios.get("/doc/getDocInfo",{params:{token:r["getters"].getToken(r["state"]),doc_id:localStorage.getItem("doc_id")}}).then((function(t){t.data.success?(localStorage.setItem("in_word_content",t.data.data[0].doc_content),e.$router.push("/redirect/editor/rich-text")):e.$message.error(t.data.message)})))},getDocTree:function(){var t=this;this.$axios.post("/team/getTeam",c.a.stringify(this.form_getTeam)).then((function(e){e.data.success&&t.$axios.get("/doc/walkDir",{params:{token:r["getters"].getToken(r["state"]),folder_id:e.data.data[0].root_id}}).then((function(e){e.data.success?t.data=e.data.data:t.$message.error(e.data.message)}))}))},handleNodeClick:function(t){console.log(t)},likeDoc:function(){var t=this;this.form_likeDoc.doc_id=localStorage.getItem("doc_id"),this.form_likeDoc.undo=!1,this.$axios.post("/user/favorite",c.a.stringify(this.form_likeDoc)).then((function(e){e.data.success?(t.is_favorite=!0,t.$message.success(e.data.message)):t.$message.error(e.data.message)}))},unlikeDoc:function(){var t=this;this.form_likeDoc.doc_id=localStorage.getItem("doc_id"),this.form_likeDoc.undo=!0,this.$axios.post("/user/favorite",c.a.stringify(this.form_likeDoc)).then((function(e){e.data.success?(t.is_favorite=!1,t.$message.success(e.data.message)):t.$message.error(e.data.message)}))},share:function(){var t=this;this.$axios.post("/worddocx/share",c.a.stringify(this.form4)).then((function(e){0===e.data.result?(alert("您的分享链接是http://124.220.205.84/#/share"+e.data.x),localStorage.setItem("refresh","1")):t.$message.error(e.data.message)}))},Like:function(){var t=this;this.$axios.post("/worddocx/user_collect_word",c.a.stringify(this.form3)).then((function(e){4===e.data.result?t.$message.success(e.data.message):t.$message.error(e.data.message)}))},back:function(){this.$router.go(-1)},deleteCooperator:function(t){var e=this;this.form_deleteCooperator.cooperation_id=t.id,this.$axios.post("/team/out_cooperate",c.a.stringify(this.form_deleteCooperator)).then((function(t){4===t.data.result?(e.getCooperatorList(),e.$message.success(t.data.message)):e.$message.error(t.data.message)}))},addComment:function(){var t=this;this.$axios.post("/worddocx/user_comment_word",c.a.stringify(this.form_addComment)).then((function(e){3===e.data.result?(t.getCommentList(),t.$message.success(e.data.message)):t.$message.error(e.data.message)}))},getCooperatorList:function(){var t=this;this.loading=!0,this.cooperatorList=[],this.$axios.post("/team/get_cooperationer_list",c.a.stringify(this.form_getCooperatorList)).then((function(e){if(4===e.data.result)for(var o=0;o<e.data.cooperation_list.length;o++){var a={id:0,username:"",email:""};a.id=e.data.cooperation_list[o].id,a.username=e.data.cooperation_list[o].username,a.email=e.data.cooperation_list[o].email,t.cooperatorList.push(a)}t.loading=!1}))},getCommentList:function(){var t=this;this.loading=!0,this.commentList=[],this.$axios.post("/worddocx/user_get_comment_list",c.a.stringify(this.form_getCommentList)).then((function(e){if(4===e.data.result)for(var o=0;o<e.data.word_comment_list.length;o++){var a={id:0,username:"",time:"",content:""};a.id=e.data.word_comment_list[o].comment_id,a.username=e.data.word_comment_list[o].comment_username,a.time=e.data.word_comment_list[o].comment_time,a.content=e.data.word_comment_list[o].comment_content,t.commentList.push(a)}t.loading=!1}))},addCooperator:function(){var t=this;this.$axios.post("/team/send_cooperate_inviter",c.a.stringify(this.form_invite)).then((function(e){5===e.data.result?(t.getCooperatorList(),t.$message.success(e.data.message)):t.$message.error(e.data.message)}))},exportPDF:function(){this.getPdf("pdfDom",this.title)},uploadModel:function(){var t=this;this.form_Model.content=this.$refs.richTextEditor.getJsonContent().slice(7,-1),this.$axios.post("/doc/editTemplate",c.a.stringify(this.form_Model)).then((function(e){e.data.success?t.$message.success(e.data.message):t.$message.error(e.data.message)}))},Save:function(){var t=this;this.form_save.doc_content=this.$refs.richTextEditor.getJsonContent().slice(7,-1),this.$axios.post("/doc/save",c.a.stringify(this.form_save)).then((function(e){e.data.success?t.$message.success(e.data.message):t.$message.error(e.data.message)}))},exitEdit:function(){var t=this;this.form.word_content=this.$refs.richTextEditor.getJsonContent().slice(7,-1),"true"===localStorage.getItem("shareFlag")?(this.$axios.post("/worddocx/user_out_edit_cooperation_word",c.a.stringify(this.form)).then((function(e){4===e.data.result?(t.$message.success(e.data.message),localStorage.setItem("enable","true"),localStorage.setItem("shareFlag","false")):t.$message.error(e.data.message)})),localStorage.setItem("shareFlag","false")):(this.$axios.post("/worddocx/user_out_edit_word",c.a.stringify(this.form)).then((function(e){3===e.data.result?(t.$message.success(e.data.message),localStorage.setItem("enable","true")):t.$message.error(e.data.message)})),this.form1.word_name=this.title,this.$axios.post("/worddocx/user_rename_word",c.a.stringify(this.form1)))},getHtmlContent:function(){this.htmlContent=this.$refs.richTextEditor.getHtmlContent(),console.log(this.htmlContent)},getJsonContent:function(){console.log(localStorage.getItem("flag")),console.log(JSON.parse(localStorage.getItem("user_word_content"))),this.jsonContent=this.$refs.richTextEditor.getJsonContent()}}},g=m,u=(o("7177"),o("2877")),f=Object(u["a"])(g,a,s,!1,null,"31679d50",null);e["default"]=f.exports},4767:function(t,e,o){},7177:function(t,e,o){"use strict";o("4767")}}]);